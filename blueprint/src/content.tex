\title{InclusionAndExclusion}


\home{https://timechess.github.io/InclusionAndExclusion}
\github{https://github.com/timechess/InclusionAndExclusion}
\dochome{https://timechess.github.io/InclusionAndExclusion/doc}

% \home{localhost:8000}
% \dochome{localhost:8000/doc}

\maketitle


\tableofcontents

\nocite{*} % Delete this line if you have citations.

\section{Introduction}


\section{FinInter}

\begin{definition}\label{List.FinInter}
  \leanok
  \lean{List.FinInter}
  Define the intersection of a list of finite sets indexed by \verb|β|, where each set is given by a function \verb|A : β → Finset α|.
\end{definition}

\begin{lemma}\label{List.eq_FinInter}
  \lean{List.eq_FinInter}
  \uses{List.FinInter}
  \leanok
  Prove that an element is in the intersection of a non-empty list of finite sets if and only if it is in each of the sets.
\end{lemma}

\begin{proof}
  \leanok
  If there's only one element in the list, then it is trival.

  Then we prove by induction.

  Assume the statement hold for a list whose length is $n$, thus an element is in the intersection is in every one of the $n$ sets.

  We add a set $S$ to the beginning of the list. For any element $x$ in the intersection of the $n+1$ sets (which is a subset of the intersection of the previous $n$ sets), it must belongs to the intersection of the previous $n$ sets and $S$. Therefor, $x\in$ the intersection of the $n+1$ sets.

  Thus, the statement holds.

\end{proof}

\begin{definition}\label{Multiset.FinInter}
  \lean{Multiset.FinInter}
  \uses{List.FinInter,List.eq_FinInter}
  Define the intersection of a multiset of finite sets indexed by \verb|β|, where each set is given by a function \verb|A : β → Finset α|.
\end{definition}

\begin{lemma}\label{Multiset.eq_FinInter}
  \lean{Multiset.eq_FinInter}
  \uses{List.FinInter,List.eq_FinInter,Multiset.FinInter}
  Prove that an element is in the intersection of a multiset of finite sets if and only if it is in each of the sets.
\end{lemma}

\begin{definition}\label{FinInter₀}
  \lean{FinInter₀}
  \uses{Multiset.FinInter}
  Define the intersection of all finite sets indexed by \verb|β|, where each set is given by a function \verb|A : β → Finset α|.
\end{definition}

\begin{lemma}\label{eq_FinInter₀}
  \lean{eq_FinInter₀}
  \uses{Multiset.eq_FinInter,FinInter₀}
  Prove that the intersection of all finite sets indexed by \verb|β| is equal to the intersection of their corresponding sets in \verb|Set α|.
\end{lemma}

\section{FinUnion}

\begin{definition}\label{List.FinUnion}
  \leanok
  \lean{List.FinUnion}
  Define the union of a list of finite sets indexed by \verb|β|, where each set is given by a function \verb|A : β → Finset α|.
\end{definition}

\begin{lemma}\label{List.eq_FinUnion}
  \lean{List.eq_FinUnion}
  \uses{List.FinUnion}
  Prove that an element is in the union of a list of finite sets if and only if it is in at least one of the sets.
\end{lemma}

\begin{proof} 
  \leanok
  Consider that we define union of sets by induction , we enumeration pointer until a set contain the element.So obviously ,they are same.
\end{proof}

\begin{definition}\label{Multiset.FinUnion}
  \lean{Multiset.FinUnion}
  \uses{List.FinUnion,List.eq_FinUnion}
  Define the union of a multiset of finite sets indexed by \verb|β|, where each set is given by a function \verb|A : β → Finset α|.
\end{definition}

\begin{lemma}\label{Multiset.eq_FinUnion}
  \lean{Multiset.eq_FinUnion}
  \uses{List.FinUnion,List.eq_FinUnion,Multiset.FinUnion}
  Prove that an element is in the union of a multiset of finite sets if and only if it is in at least one of the sets.
\end{lemma}

\begin{proof} 
  \leanok
  Multiset just have some repeat element. So it's also obviously when List.eq_FinUnion is right
\end{proof}

\begin{definition}\label{FinUnion₀}
  \lean{FinUnion₀}
  \uses{Multiset.FinUnion}
  Define the union of all finite sets indexed by \verb|β|, where each set is given by a function \verb|A : β → Finset α|.
\end{definition}

\begin{lemma}\label{eq_FinUnion₀}
  \lean{eq_FinUnion₀}
  \uses{Multiset.eq_FinUnion,FinUnion₀}
  Prove that the union of all finite sets indexed by \verb|β| is equal to the union of their corresponding sets in \verb|Set α|.
\end{lemma}

\begin{proof}
    \leanok
    It's also really obviously when Multiset.eq_FinUnion is right.
\end{proof}
\section{ToInt}

\begin{definition}\label{toInt}
  \leanok
  \lean{toInt}
  Assign a value to a proposition. If the proposition holds, assign a value of 1; otherwise, assign a value of 0.
\end{definition}

\begin{lemma}\label{toInt_and}
  \lean{toInt_and}
  \uses{toInt}
  \leanok
  The value of both propositions P and Q holding is equal to the value of P times the value of Q.
\end{lemma}

\begin{proof}
  \leanok
\end{proof}

\begin{lemma}\label{toInt_not}
  \lean{toInt_not}
  \uses{toInt}
  \leanok
  The value of the negation of a proposition P is equal to 1 minus the value of P.
\end{lemma}

\begin{proof}
  \leanok
\end{proof}

\begin{definition}\label{char_fun}
  \leanok
  \lean{char_fun}
  \uses{toInt}
  Define a characteristic function that returns 1 if \verb|x| is in the finite set \verb|A|, and 0 otherwise.
\end{definition}

\begin{lemma}\label{char_fun_inter}
  \lean{char_fun_inter}
  \uses{toInt,toInt_and,char_fun}
  The characteristic function of the intersection of two finite sets \verb|A| and \verb|B| is equal to the product of their characteristic functions.
\end{lemma}

\begin{lemma}\label{char_fun_union}
  \lean{char_fun_union}
  \uses{toInt,toInt_and,toInt_not,char_fun}
  The characteristic function of the union of two finite sets \verb|A| and \verb|B| is equal to 1 minus the product of 1 minus their characteristic functions.
\end{lemma}

\begin{proof}
    \leanok

Consider a family of finite sets \(\{A_\beta\}\) indexed by \(\beta\), and let the union of these sets be \(A = \bigcup_\beta A_\beta\). The characteristic function \(\chi_{A_\beta}\) takes the value 1 for elements in \(A_\beta\) and 0 for elements outside.

For the characteristic function \(\chi_A\) of the union \(A\), it takes the value 1 for any element in \(\bigcup_\beta A_\beta\) and 0 for elements outside the union. Our goal is to show that \(\chi_A = 1 - \prod_\beta (1 - \chi_{A_\beta})\).

Let's reason as follows: for any element outside the union \(A\), it is not in any of the \(A_\beta\), so \(\chi_{A_\beta}(x) = 0\) for every \(\beta\), making \((1 - \chi_{A_\beta}(x)) = 1\). Therefore, the product \(\prod_\beta (1 - \chi_{A_\beta}(x)) = 1\), and thus \(1 - \prod_\beta (1 - \chi_{A_\beta}(x)) = 0\), matching the value of \(\chi_A\) outside the union.

On the other hand, for any element inside the union \(A\), it belongs to at least one set \(A_\beta\). This means there exists at least one \(\beta\) such that \(\chi_{A_\beta}(x) = 1\). Consequently, there is at least one \((1 - \chi_{A_\beta}(x)) = 0\). The product \(\prod_\beta (1 - \chi_{A_\beta}(x))\) hits zero as soon as the first zero is encountered, and thus \(1 - \prod_\beta (1 - \chi_{A_\beta}(x)) = 1\), matching the value of \(\chi_A\) inside the union.。

\end{proof}

\section{Auxiliary}

\begin{definition}\label{Finset.powerset₀}
  \leanok
  \lean{Finset.powerset₀}
  Define the set of all nonempty subsets of a given finite set \verb|A|.
\end{definition}

\begin{lemma}\label{card_eq}
  \lean{card_eq}
  If a finite set \verb|A| is equal to a set \verb|B| in the sense of set theory, then they have the same number of elements.
\end{lemma}

\begin{lemma}\label{mul_expand₃}
  \lean{mul_expand₃}
  Formalize the polynomial expansion of the product \(\prod_{i=0}^{n-1} (1 - g(i))\).
\end{lemma}

\begin{lemma}\label{mul_expand₂}
  \lean{mul_expand₂}
  \uses{Finset.powerset₀,mul_expand₃}
  Formalize the polynomial expansion of \(1 - \prod_{i=0}^{n-1} (1 - g(i))\).
\end{lemma}

\begin{lemma}\label{mul_expand₁}
  \lean{mul_expand₁}
  \uses{Finset.powerset₀,mul_expand₂}
  Formalize the polynomial expansion of \(1 - \prod_{i=0}^{n-1} (1 - g(i))\) in the context of finite sets of natural numbers up to \verb|n|.
\end{lemma}


\section{MainTheorem}

\begin{lemma}\label{card_eq_sum_char_fun}
  \lean{card_eq_sum_char_fun}
  \uses{toInt,char_fun,card_eq}
  The cardinality of a subset \verb|B| of \verb|A| is equal to the sum of the characteristic function of \verb|B| over \verb|A|.
\end{lemma}

\begin{lemma}\label{card_eq_FinInter}
  \lean{card_eq_FinInter}
  \uses{FinInter₀,eq_FinInter₀,card_eq}
  The cardinality of the intersection of a family of finite sets indexed by \verb|β| is equal to the cardinality of their intersection in \verb|Finset| form.
\end{lemma}

\begin{lemma}\label{card_eq_FinUnion}
  \lean{card_eq_FinUnion}
  \uses{card_eq,FinUnion₀,eq_FinUnion₀}
  The cardinality of the union of a family of finite sets indexed by \verb|β| is equal to the cardinality of their union in \verb|Finset| form.
\end{lemma}

\begin{proof}
    \leanok
The cardinality of the union of a family of finite sets indexed by \(\beta\) is equal to the cardinality of their union in \(\text{Finset}\) form. Here, the characteristic function represents the size of the set. Let's provide a proof in plain language.

Consider a family of finite sets \(\{A_\beta\}\) indexed by \(\beta\), and let the union of these sets be \(A = \bigcup_\beta A_\beta\). We represent the union of these sets in \(\text{Finset}\) form, ensuring that all set elements are unique. In \(\text{Finset}\) form, the cardinality of a set is simply the number of elements in the set.

To show that the cardinality of \(A\) is equal to the cardinality of the union in \(\text{Finset}\) form, we compare the elements in both sets. Any element in \(A\) must belong to at least one set \(A_\beta\). Since \(\text{Finset}\) guarantees the uniqueness of elements, this means that in the union in \(\text{Finset}\) form, each element also occurs exactly once.

Thus, regardless of whether an element belongs to a single set or appears in multiple sets, as long as it is in the union \(A\), it will also appear once in the union in \(\text{Finset}\) form. This ensures that the cardinality of \(A\) is precisely equal to the cardinality of the union in \(\text{Finset}\) form.

\end{proof}

\begin{lemma}\label{char_fun_FinInter}
  \lean{char_fun_FinInter}
  \uses{FinInter₀,eq_FinInter₀,toInt,char_fun}
  The characteristic function of the intersection of a family of finite sets indexed by \verb|β| is equal to the product of their characteristic functions.
\end{lemma}

\begin{lemma}\label{char_fun_FinUnion}
  \lean{char_fun_FinUnion}
  \uses{FinUnion₀,eq_FinUnion₀,toInt,char_fun}
  The characteristic function of the union of a family of finite sets indexed by \verb|β| is equal to 1 minus the product of 1 minus their characteristic functions.
\end{lemma}

\begin{proof}
  \leanok
The characteristic function of the union of a family of finite sets indexed by \(\beta\) is equal to 1 minus the product of 1 minus their characteristic functions. Let's prove this theorem using plain language.

Suppose we have a family of finite sets indexed by \(\beta\), denoted as \(\{A_\beta\}\), and consider the union of these sets, \(A = \bigcup_\beta A_\beta\). The characteristic function \(\chi_{A_\beta}\) defines a function for each set \(\beta\), being 1 for any element in \(A_\beta\) and 0 for any element not in the set.

Now, consider the characteristic function \(\chi_A\) of the union \(A\), which also follows the rule: 1 for elements in \(A\) and 0 for elements not in \(A\).

To prove that \(\chi_A = 1 - \prod_\beta (1 - \chi_{A_\beta})\), we consider two scenarios:

1. **Elements not in the union** (\(x \not\in A\)): If an element is not in \(A\), it means it is not in any \(A_\beta\). Thus, for every characteristic function \(\chi_{A_\beta}\) of a set \(A_\beta\), the value of the function for that element is 0. Hence, \(1 - \chi_{A_\beta} = 1\). Since the element is not in any \(A_\beta\), \(\prod_\beta (1 - \chi_{A_\beta}) = 1\), and thus \(1 - \prod_\beta (1 - \chi_{A_\beta}) = 0\), which aligns with the definition of the characteristic function \(\chi_A\) (value 0 for elements not in the union).

2. **Elements in the union** (\(x \in A\)): If an element is in \(A\), the element is in at least one \(A_\beta\). This means there is at least one \(\beta\) for which \(\chi_{A_\beta} = 1\). Thus, there is at least one \(1 - \chi_{A_\beta} = 0\). The product \(\prod_\beta (1 - \chi_{A_\beta})\) will be zero due to encountering at least one 0, leading to \(1 - \prod_\beta (1 - \chi_{A_\beta}) = 1\). This also aligns with the definition of the characteristic function \(\chi_A\) (value 1 for elements in the union).

With this analysis, we have proven the theorem.
\end{proof}

\begin{lemma}\label{mul_expand₀}
  \lean{mul_expand₀}
  \uses{Finset.powerset₀,mul_expand₁}
  The polynomial expansion of \(1 - \prod_{i=0}^{n-1} (1 - g(i))\).
\end{lemma}

\begin{theorem}\label{Principle_of_Inclusion_Exclusion}
  \lean{Principle_of_Inclusion_Exclusion}
  \uses{FinInter₀,FinUnion₀,eq_FinInter₀,eq_FinUnion₀,Finset.powerset₀,char_fun,card_eq_sum_char_fun,char_fun_FinInter,char_fun_FinUnion,card_eq,card_eq_FinInter,card_eq_FinUnion,mul_expand₀}
  The principle of inclusion-exclusion for a finite union of finite sets.
\end{theorem}

